<template>
    <template if:true={relatedData}>
        <div class="slds-grid slds-wrap">
            <template for:each={relatedData} for:item="objectData" for:index="objectIndex">
                <div key={objectData.objectName}
                    class="slds-col slds-size_1-of-1 slds-small-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-p-around_xx-small">
                    <div class="TableCard">
                        <div class="TableCardHeader slds-grid slds-grid_align-spread">
                            <h2 class="TableCardTitle">{objectData.objectLabel}</h2>
                        </div>
                        <div class="TableCardBody">
                            <div style="height:100%" class="slds-scrollable_x">
                                <template if:true={objectData.allRecords.length}>
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_fixed-layout">
                                        <thead>
                                            <tr>
                                                <th scope="col">Name</th>
                                                <template for:each={objectData.fields} for:item="field">
                                                    <th scope="col" key={field.apiName}>{field.label}</th>
                                                </template>
                                                <th scope="col">See Details</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template for:each={getPagedRecords(objectData)} for:item="record" for:index="recordIndex">
                                                <tr key={record.recordUrl}>
                                                    <td class="truncate-cell" title={record.name}>
                                                        <a href={record.recordUrl} class="slds-text-link">{record.name}</a>
                                                    </td>
                                                    <template for:each={record.fieldValues} for:item="fieldValue">
                                                        <td key={fieldValue} class="truncate-cell" title={fieldValue}>{fieldValue}</td>
                                                    </template>
                                                    <td style="text-align: -webkit-center;">
                                                        <lightning-icon icon-name="utility:threedots" size="xx-small"
                                                            alternative-text="See Details" title="See Details"
                                                            data-index={recordIndex} data-objectindex={objectIndex}
                                                            onclick={handlePrintRecord}>
                                                        </lightning-icon>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>

                                    <!-- Pagination Footer -->
                                    <div class="slds-card__footer slds-grid slds-wrap slds-grid_align-spread slds-p-around_x-small">
                                        <div class="slds-text-body_small slds-text-color_weak">
                                            Showing
                                            <span class="slds-text-title_bold">{(objectData.page - 1) * 5 + 1}</span>
                                            to
                                            <span class="slds-text-title_bold">
                                                {Math.min(objectData.page * 5, objectData.allRecords.length)}
                                            </span>
                                            of
                                            <span class="slds-text-title_bold">{objectData.allRecords.length}</span> results
                                        </div>
                                        <div>
                                            <div class="slds-button-group" role="group">
                                                <button class="slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small"
                                                    onclick={handlePrev} data-objectindex={objectIndex}
                                                    disabled={objectData.page === 1} title="Previous">
                                                    <lightning-icon icon-name="utility:chevronleft" alternative-text="Previous" size="xx-small"></lightning-icon>
                                                </button>
                                                <span style="margin: 0 0.5rem;">{objectData.page} / {getTotalPages(objectData)}</span>
                                                <button class="slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small"
                                                    onclick={handleNext} data-objectindex={objectIndex}
                                                    disabled={objectData.page === getTotalPages(objectData)} title="Next">
                                                    <lightning-icon icon-name="utility:chevronright" alternative-text="Next" size="xx-small"></lightning-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <template if:false={objectData.allRecords.length}>
                                    <div class="no-records-container">
                                        <div class="slds-illustration slds-illustration_small">
                                            <div class="slds-text-longform">
                                                <h3 class="slds-text-heading_medium">No Records Found</h3>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </template>

    <template if:true={error}>
        <p class="slds-text-color_error">Error: {error.body.message}</p>
    </template>

    <template if:true={showmodal}>
        <!-- Existing modal code unchanged -->
    </template>
</template>
